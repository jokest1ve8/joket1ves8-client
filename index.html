<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="google-signin-client_id" content="190393742197-si6eu1vj1krk6vam3d5o17m7tv9v8ifk.apps.googleusercontent.com">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

    <title>Jokest1ve8!</title>
</head>

<body>
    
    <!-- Navbar -->
    <nav class="navbar  navbar-light bg-warning navbar-fixed-top" id="nav">
        <a class="navbar-brand"> <strong> Jokest1ve8 </strong></a>
        <div class="form-inline">
            <button class="btn btn-outline-success my-2 my-sm-0" onclick="logout()" type="submit" id="logout-btn">Logout</button>
        </div>
    </nav>

    <!-- Login Form -->
    <div >
        <div class=" jumbotron" id="loginPage">
            <h1 style="font-family: 'Courier New', Courier, monospace; font-weight: bold;" class="alert text-warning text-center">Login Page</h1>
            <form id="login-form" class="container">
                <div class="form-group col-5 ">
                    <label class="text-warning" for="loginInputEmail">Email address</label>
                    <input type="email" class="form-control" id="loginInputEmail" aria-describedby="emailHelp" required>
                    <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>
                </div>
                <div class="form-group col-5">
                    <label class="text-warning" for="loginInputPassword">Password</label>
                    <input type="password" class="form-control" id="loginInputPassword" required>
                </div>
               
                <div class="text-center"> 
                    <button type="submit" class="btn btn-warning btn-lg ">Login</button>
            </form>
                    <button type="button" onclick="registerForm()" class="btn btn-info btn-lg ">Register</button>
                    <div class="g-signin2 btn" data-onsuccess="onSignIn"></div>

                </div>
            
               
            </div>
    </div>

    <!-- Register Form -->
    <form id="register-form" class="container">
        <br><br>
        <h1 style="font-family: 'Courier New', Courier, monospace; font-weight: bold;" class="alert text-info text-center">Register Page</h1>

        <div class="form-group">
            <label for="InputFirstname">First name</label>
            <input type="text" class="form-control" id="InputFirstname" required>
        </div>
        <div class="form-group">
            <label for="InputLastname">Last name</label>
            <input type="text" class="form-control" id="InputLastname">
        </div>
        <div class="form-group">
            <label for="InputEmail">Email address</label>
            <input type="email" class="form-control" id="InputEmail" aria-describedby="emailHelp" required>
            <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>
        </div>
        <div class="form-group">
            <label for="InputPassword">Password</label>
            <input type="password" class="form-control" id="InputPassword" required>
        </div>
        <button type="submit" class="btn btn-info btn-block">Submit</button>
        <br>
        <p style="text-align: center;">already have an   account? <a href="" onclick="showLogin()">login</a></p>
        <br>
    </form>

    <!-- Main Page -->
    <div class="container-fluid text-white text-center mt-10" id="mainPage" >
        <div class=" d-flex justify-content-center ">
        <button type="button" id="btn-add" onclick="createPage()" class="btn btn-warning btn-lg mr-1">&#128512 Bring me your Jokes &#128512</button>
        <button type="button" id="btn-myjokes" onclick="myJokes()" class="btn btn-outline-dark btn-lg mr-1">Your Jokes</button>
        <button type="button" id="btn-myjokes" onclick="dadJokes()" class="btn btn-outline-dark btn-lg mr-1">Dad Jokes &#129312</button>
        <!-- <button type="button" id="btn-myJokes" onclick="createPage()" class="btn btn-outline-dark btn-lg ml-1">Your Jokes</button> -->
        </div>
        <br><br>
        <div class="row" id="listJokesMainPage">


        </div>
    </div>

    <!-- random dad joke -->

    <div class="container-fluid text-white text-center mt-10" id="dadJokePage" >
        <div class=" d-flex justify-content-center ">
        <button type="button" id="btn-add" onclick="randomDadJoke()" class="btn btn-warning btn-lg mr-1">click me &#128512</button>   
        </div>
        
        <br><br>
        <div class="row" id="listRandomDadJoke">


        </div>
        <button type="button" onclick="mainPage()" class="btn btn-secondary btn-sm ">&#8678 Back</button>
    </div>


    <!-- add new Jokes -->

    <div class=" jumbotron" id="addNew">
        <h1 style="font-family: 'Courier New', Courier, monospace; font-weight: bold;" class="alert text-dark text-center"> <strong>Your Jokes </strong></h1>
        <form id="create-form" class="container">
            <div class="form-group col-5 ">
                <label class="text-dark" for="newUrl"> <b>Url Picture </b> </label>
                <input type="email" class="form-control" id="newUrl" placeholder="put the url link of your picture here" aria-describedby="emailHelp">
            </div>
            <div class="form-group col-5">
                <label class="text-dark"  for="newCaption"> <b> Caption</b></label>
                <input type="text" id="caption" class="form-control" id="newCaption">
            </div>
            <br><br>
            <div class="text-center">
                <button type="submit" class="btn btn-warning btn-lg w-50 ">Add Joke</button>
                <br><br>
                <button type="button" onclick="mainPage()" class="btn btn-warning btn-lg w-50 ">cancel &#128546</button>
            </div>
        </form>
    </div>

    <!-- My Jokes -->
    <div class="container-fluid text-white text-center mt-10" id="myJokes" >
        <br><br><br>
        <h1 style="font-family: 'Courier New', Courier, monospace; font-weight: bold;" class="text-dark">All of Your Jokes</h1>
        <hr class="my-4">
        <button type="button" onclick="mainPage()" class="btn btn-secondary btn-sm ">&#8678 Back</button>
        <br><br>
        <div class="row" id="listJokesUserPage">
            
        </div>
    </div>


    

    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
        crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
         crossorigin="anonymous"></script>

        <script>
            let baseUrl = 'http://localhost:3000'

            // function fetchJokes(){
            //     let access_token = localStorage.access_token

            // }
            function registerForm(){
                $("#loginPage").hide()
                $("#mainPage").hide()
                $("#register-form").show()
                $("#addNew").hide()
                $("#myJokes").hide()
                $("#logout-btn").hide()
                $("#dadJokePage").hide()
                
                
            }
            function showLogin(){
                $("#loginPage").show()
                $("#register-form").hide()
                $("#mainPage").hide()
                $("#addNew").hide()
                $("#myJokes").hide()
                $("#logout-btn").hide()
                $("#dadJokePage").hide()
            }
            function mainPage(){
                $("#loginPage").hide()
                $("#register-form").hide()
                $("#mainPage").show()
                $("#addNew").hide()
                $("#logout-btn").show()
                $("#myJokes").hide()
                $("#dadJokePage").hide()
            }

            function dadJokes(){
                $("#loginPage").hide()
                $("#register-form").hide()
                $("#mainPage").hide()
                $("#addNew").hide()
                $("#logout-btn").show()
                $("#myJokes").hide()
                $("#dadJokePage").show()
            }

            function myJokes(){
                $("#loginPage").hide()
                $("#register-form").hide()
                $("#mainPage").hide()
                $("#addNew").hide()
                $("#myJokes").show()
                $("#logout-btn").show()
                $("#dadJokePage").hide()
            }

            function createPage(){
                $("#loginPage").hide()
                $("#register-form").hide()
                $("#mainPage").hide()
                $("#addNew").show()
                $("#logout-btn").show()
                $("#myJokes").hide()
                $("#dadJokePage").hide()
            }
            function logout(){
                localStorage.clear();
                showLogin()
                var auth2 = gapi.auth2.getAuthInstance();
                auth2.signOut().then(function () {
                console.log('User signed out.');
                });
            }

            function fetchJokes(){
                $("#listJokesMainPage").empty()
                $.ajax({
                    url: "http://localhost:3000/jokes",
                    method: "GET",
                    headers: {
                        access_token: localStorage.getItem('access_token')
                    }
                })
                .done(response => {
                    for(let i  = 0; i < response.length; i++){
                        $("#listJokesMainPage").append(` 
                        <div class=" col-sm-4 pt-5 pb-5 " style="width: 18rem;">
                            <img src="${response[i].imageUrl}"
                                class="card-img-top">
                            <div class="card">
                                <p class="card-text text-body">${response[i].description}</p>
                            </div>
                        </div>`)
                    }
                })
                .fail(error => {
                    console.log(error)
                })
            }

            function fetchJokesUser(){
                $("#listJokesUserPage").empty()
                $.ajax({
                    url: "http://localhost:3000/jokes",
                    method: "GET",
                    headers: {
                        access_token: localStorage.getItem('access_token')
                    }
                })
                .done(response => {
                    for(let i  = 0; i < response.length; i++){
                        $("#listJokesUserPage").append(` 
                        <div class=" col-sm-4 pt-5 pb-5 " style="width: 18rem;">
                            <button type="button" onclick="deleteJoke(${response[i].id})" class="btn btn-outline-danger">DELETE</button>
                            <img src="${response[i].imageUrl}"
                                class="card-img-top">
                            <div class="card">
                                <p class="card-text text-body">${response[i].description}</p>
                                <button type="button" id="btn-delete" onclick="deleteJoke(${response[i].id})" class="btn btn-outline-danger"> Delete &#128546</button>
                            </div>
                        </div>`)

                    }
                })
                .fail(error => {
                    console.log(error)
                })
            }

            function login(){
                const email = $('#loginInputEmail').val()
                const password = $('#loginInputPassword').val()
                $.ajax({
                    url:baseUrl+'/login',
                    method:"POST",
                    data:{
                        email,
                        password
                    }
                })
                .done(response => {
                    localStorage.setItem('access_token',response.access_token)
                    mainPage();
                })
                .fail(err => {
                    console.log(err);
                })
                .always(_ => {
                    $('#loginInputEmail').val("")
                    $('#loginInputPassword').val("")
                }) 
            }

            function onSignIn(googleUser) {
                let googleToken = googleUser.getAuthResponse().id_token;
                $.ajax({
                    url: `${baseUrl}/googleLogin`,
                    method: 'POST',
                    data: {
                        googleToken
                    }
                })
                .done(response =>{
                    localStorage.setItem('access_token', response.access_token)
                    mainPage()

                })
                .fail(err =>{
                    console.log(err)
                })
            }
            function register(){
                const firstname=$("#InputFirstname").val()
                const lastname=$("#InputLastname").val()
                const email=$("#InputEmail").val()
                const password=$("#InputPassword").val()

                $.ajax({
                    url:baseUrl+'/register',
                    method:"POST",
                    data:{
                        firstname,
                        lastname,
                        email,
                        password
                    }
                })
                .done(response => {
                    showLogin();
                })
                .fail(err => {
                    console.log(err)
                })
                .always(_ => {
                    $("#InputFirstname").val("")
                    $("#InputLastname").val("")
                    $("#InputEmail").val("")
                    $("#InputPassword").val("")
                })
            }

            function randomDadJoke(){
                $("#listRandomDadJoke").empty()
                $.ajax({
                    url: "http://localhost:3000/randomDadJoke",
                    method: "GET",
                    headers: {
                        access_token: localStorage.getItem('access_token')
                    }
                })
                .done(response => {
                    $("#listRandomDadJoke").append(`<h3>${response.joke}</h3>`)
                })
                .fail(error => {
                    console.log(error)
                })
            }

            function deleteJoke(id){
                $.ajax({
                    url:baseUrl+'/jokes/'+id,
                    method:"DELETE",
                    headers:{
                        access_token:localStorage.getItem('access_token')
                    }
                })
                .done(response => {
                    mainPage();
                })
                .fail(err => {
                    console.log(err)
                })
            }

            // 7 Timer API
            function weather(position){
                $('#mainPage').append(
                  `
                    <img src='http://www.7timer.info/bin/civil.php?lon=${position.coords.longitude}&lat=${position.coords.latitude}&ac=0&lang=en&unit=metric&output=internal&tzshift=0'/>
                  `
                 )
            }

            $(document).ready(() =>{
                if(localStorage.getItem('access_token')){
                    mainPage()

                } else {
                    showLogin()
                }

                $("#login-form").on('submit' , function (e) {
                    e.preventDefault();
                    // login();
                    mainPage()
                })
                $("#register-form").on('submit' , function (e) {
                    e.preventDefault();
                    //showLogin()
                    register();
                })

            })
        </script>

    <!-- Responsive Voice API -->
    <!-- <script src="https://code.responsivevoice.org/responsivevoice.js?key=v4TToiND"></script>
    <Script>
        var say = prompt ("Ketik untuk bicara")
        responsiveVoice.speak('kemarin saya beli permen karet, pas saya kunyah rasanya pedes, ternyata karetnya dua. hahahahhahaha lucu kan lucu kan', "Indonesian Male")
    </Script> -->
</body>

</html>